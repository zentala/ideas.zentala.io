---
import MainLayout from "../../layouts/MainLayout.astro";
import { getCollection } from 'astro:content';

// Get all posts and drafts
const isDev = import.meta.env.DEV;
const posts = await getCollection('posts');

// Try to get drafts, but handle the case when the collection doesn't exist
let drafts = [];
if (isDev) {
  try {
    drafts = await getCollection('drafts');
  } catch (error) {
    console.warn('No drafts collection found or it is empty');
  }
}

// Get all unique tags
const allTags = [...posts, ...drafts]
  .flatMap(post => post.data.tags || []);

const tags = [...new Set(allTags)].sort();

// Count posts per tag
const tagCounts = tags.reduce((acc, tag) => {
  acc[tag] = [...posts, ...drafts]
    .filter(post => post.data.tags && post.data.tags.includes(tag))
    .length;
  return acc;
}, {} as Record<string, number>);
---

<MainLayout 
  title="Browse Ideas by Tags"
  description="Browse all ideas organized by tags"
>
  <div class="max-w-3xl mx-auto">
    <h1 class="text-4xl font-bold mb-8 text-center font-['Space_Grotesk']">
      <span class="text-[#5b34da]">Browse</span> Ideas by Tags
    </h1>
    
    <div class="border border-white/10 rounded-lg p-8 bg-[#1a1a1a]">
      <div class="flex flex-wrap gap-4 justify-center">
        {tags.map(tag => (
          <a 
            href={`/tags/${tag}`}
            class="px-5 py-3 bg-[#2a2a2a] border border-white/10 rounded-lg 
              hover:bg-[#3a3a3a] hover:border-[#5b34da]/50 transition-all flex items-center"
          >
            <span class="text-lg font-medium font-['Space_Grotesk']">{tag}</span>
            <span class="ml-2 px-3 py-0.5 bg-[#5b34da] text-white text-sm rounded-full">
              {tagCounts[tag]}
            </span>
          </a>
        ))}
      </div>
    </div>
  </div>
</MainLayout>