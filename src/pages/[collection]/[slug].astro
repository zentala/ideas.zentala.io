---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';

// Generate static paths for all posts
export async function getStaticPaths() {
  const postsEntries = await getCollection('posts');
  const draftsEntries = import.meta.env.DEV 
    ? await getCollection('drafts') 
    : [];
  
  const entries = [...postsEntries, ...draftsEntries];
  
  return entries.map(entry => ({
    params: { 
      collection: entry.collection, 
      slug: entry.slug 
    },
    props: { entry },
  }));
}

// Get the post entry from props
const { entry } = Astro.props;
const { Content } = await entry.render();

const { title, description, image, tags, pubDate, draft } = entry.data;
const date = pubDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<MainLayout 
  title={title}
  description={description}
  image={image}
  isDraft={draft || entry.collection === 'drafts'}
>
  <article class="max-w-3xl mx-auto">
    <div class="bg-[#1a1a1a] p-8 rounded-lg border border-white/10 mb-8">
      <header class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold mb-4 font-['Space_Grotesk']">{title}</h1>
        <p class="text-white/60 text-sm mb-6">Published on {date}</p>
        
        {tags && tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-6">
            {tags.map(tag => (
              <a 
                href={`/tags/${tag}`}
                class="px-3 py-1 bg-[#2a2a2a] text-white/70 text-sm rounded-md border border-white/10
                  hover:bg-[#3a3a3a] hover:border-[#5b34da]/50 transition-all"
              >
                {tag}
              </a>
            ))}
          </div>
        )}
        
        {image && (
          <img 
            src={image} 
            alt={title} 
            class="w-full h-auto rounded-lg mb-8 max-h-80 object-cover border border-white/10" 
          />
        )}
      </header>
      
      <div class="prose prose-lg prose-invert max-w-none">
        <Content />
      </div>
    </div>
    
    <div class="flex justify-between mt-8">
      <a href="/" class="px-4 py-2 bg-[#2a2a2a] text-white/80 text-sm rounded-md border border-white/10 
        hover:bg-[#3a3a3a] hover:border-[#5b34da]/50 transition-all">
        ‚Üê Back to ideas
      </a>
      
      <a href="/tags" class="px-4 py-2 bg-[#2a2a2a] text-white/80 text-sm rounded-md border border-white/10 
        hover:bg-[#3a3a3a] hover:border-[#5b34da]/50 transition-all">
        Browse by tags
      </a>
    </div>
  </article>
</MainLayout>